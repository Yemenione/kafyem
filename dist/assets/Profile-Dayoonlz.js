import{u as M,m as V,c as W,b as X,d as G,r as d,j as e,L as y,B as i,a as u,t as j}from"./index-CXRzGYYB.js";import{N as A,U as $,H as z,B as S,X as J}from"./Navbar-BQicr_yf.js";import{I as c}from"./input-DmEUPcbP.js";import{P as w}from"./package-0Pb3TpbO.js";import{C as K,M as Q}from"./map-pin-B9siAJD0.js";import{L as Y}from"./log-out-BwOa4z5g.js";import{S as Z}from"./shopping-bag-BIvf1kpX.js";import"./createLucideIcon-DYHEWQHk.js";import"./trash-2-BPVosxM9.js";import"./search-ghY-3tdw.js";const ne=()=>{const{t:a,i18n:L}=M(),{user:l,logout:P}=V(),{wishlist:k,toggleWishlist:U}=W(),{addToCart:R}=X(),[N]=G(),[o,n]=d.useState(N.get("tab")||"orders"),[_,D]=d.useState([]),[I,B]=d.useState([]),[C,E]=d.useState([]),[f,F]=d.useState(!1),[r,x]=d.useState({label:"",street_address:"",city:"",postal_code:"",country:"France",phone:""});d.useEffect(()=>{const s=N.get("tab");s&&n(s)},[N]),d.useEffect(()=>{(async()=>{if(!(!l||!l.id))try{const t="https://api.yemenimarket.fr/",m={headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}},[v,b,g]=await Promise.all([u.get(`${t}/api/orders`,m),u.get(`${t}/api/customer/address`,m),u.get(`${t}/api/customer/invoices`,m)]),q=v.data.map(h=>({id:h.order_number,date:new Date(h.created_at).toLocaleDateString(),total:Number(h.total_amount),status:h.status,items:h.order_items.map(H=>H.product_id)}));D(q),B(b.data),E(g.data)}catch(t){console.error("Failed to fetch profile data:",t),j.error(a("failed_fetch_profile_data"))}})()},[l,f,a]);const O=async s=>{s.preventDefault();try{const t="https://api.yemenimarket.fr/",p=localStorage.getItem("token");await u.post(`${t}/api/customer/address`,r,{headers:{"Content-Type":"application/json",Authorization:`Bearer ${p}`}}),F(!1),x({label:"",street_address:"",city:"",postal_code:"",country:"France",phone:""}),j.success(a("address_saved_successfully"))}catch(t){console.error(t),j.error(a("error_save_address"))}};if(!l)return e.jsxs("div",{className:"min-h-screen bg-[#F9F7F5]",children:[e.jsx(A,{}),e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen p-20 text-center",children:[e.jsx($,{size:64,className:"text-gold/20 mb-6"}),e.jsx("h2",{className:"font-serif text-3xl font-bold text-coffee-dark mb-4",children:a("auth_required")}),e.jsx("p",{className:"text-gray-500 mb-8 max-w-sm",children:a("please_login_to_access_profile")}),e.jsx(y,{to:"/login",children:e.jsx(i,{className:"bg-coffee-dark text-gold hover:bg-gold hover:text-coffee-dark px-12 h-12",children:a("login_now")})})]})]});const T=async s=>{try{const t="https://api.yemenimarket.fr/",p=localStorage.getItem("token"),m=await fetch(`${t}/api/invoices/${s.id}/pdf`,{headers:{Authorization:`Bearer ${p}`}});if(!m.ok)throw new Error("Download failed");const v=await m.blob(),b=window.URL.createObjectURL(v),g=document.createElement("a");g.href=b,g.download=`invoice-${s.invoice_number}.pdf`,document.body.appendChild(g),g.click(),window.URL.revokeObjectURL(b)}catch(t){console.error("PDF Error:",t),j.error("Failed to download invoice")}};return e.jsxs("div",{className:"min-h-screen bg-[#F9F7F5]",children:[e.jsx(A,{}),e.jsx("div",{className:"bg-[#1A1A1A] pt-32 pb-16",children:e.jsx("div",{className:"container mx-auto px-4",children:e.jsxs("div",{className:"flex items-center gap-8",children:[e.jsx("div",{className:"w-24 h-24 rounded-full bg-gold/10 flex items-center justify-center text-gold text-4xl font-serif border-2 border-gold/30 backdrop-blur-sm",children:(l.full_name||l.email||"U").charAt(0).toUpperCase()}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-4xl font-serif font-bold text-white mb-2",children:a("welcome_name",{name:l.full_name||a("user_guest")})}),e.jsxs("p",{className:"text-gray-400 flex items-center gap-2",children:[e.jsx("span",{className:"w-2 h-2 rounded-full bg-green-500"}),l.email]})]})]})})}),e.jsx("div",{className:"container mx-auto px-4 py-16",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-12",children:[e.jsx("div",{className:"w-full lg:w-72 flex-shrink-0",children:e.jsx("div",{className:"bg-white rounded-xl shadow-soft border border-gray-100 overflow-hidden sticky top-32",children:e.jsxs("nav",{className:"flex flex-col p-3 space-y-1",children:[e.jsxs("button",{onClick:()=>n("orders"),className:`flex items-center gap-3 px-5 py-4 rounded-lg transition-all ${o==="orders"?"bg-gold/10 text-coffee-dark font-bold border-l-4 border-gold":"text-gray-500 hover:bg-gray-50"}`,children:[e.jsx(w,{size:20})," ",e.jsx("span",{className:"text-sm tracking-wide uppercase font-semibold",children:a("my_orders")})]}),e.jsxs("button",{onClick:()=>n("wishlist"),className:`flex items-center gap-3 px-5 py-4 rounded-lg transition-all ${o==="wishlist"?"bg-gold/10 text-coffee-dark font-bold border-l-4 border-gold":"text-gray-500 hover:bg-gray-50"}`,children:[e.jsx(z,{size:20})," ",e.jsx("span",{className:"text-sm tracking-wide uppercase font-semibold",children:a("wishlist")})]}),e.jsxs("button",{onClick:()=>n("invoices"),className:`flex items-center gap-3 px-5 py-4 rounded-lg transition-all ${o==="invoices"?"bg-gold/10 text-coffee-dark font-bold border-l-4 border-gold":"text-gray-500 hover:bg-gray-50"}`,children:[e.jsx(K,{size:20})," ",e.jsx("span",{className:"text-sm tracking-wide uppercase font-semibold",children:a("invoices")})]}),e.jsxs("button",{onClick:()=>n("addresses"),className:`flex items-center gap-3 px-5 py-4 rounded-lg transition-all ${o==="addresses"?"bg-gold/10 text-coffee-dark font-bold border-l-4 border-gold":"text-gray-500 hover:bg-gray-50"}`,children:[e.jsx(Q,{size:20})," ",e.jsx("span",{className:"text-sm tracking-wide uppercase font-semibold",children:a("addresses")})]}),e.jsxs("button",{onClick:()=>n("profile"),className:`flex items-center gap-3 px-5 py-4 rounded-lg transition-all ${o==="profile"?"bg-gold/10 text-coffee-dark font-bold border-l-4 border-gold":"text-gray-500 hover:bg-gray-50"}`,children:[e.jsx($,{size:20})," ",e.jsx("span",{className:"text-sm tracking-wide uppercase font-semibold",children:a("account_details")})]}),e.jsx("div",{className:"h-px bg-gray-100 my-4 mx-4"}),e.jsxs("button",{onClick:P,className:"flex items-center gap-3 px-5 py-4 rounded-lg text-red-500 hover:bg-red-50 transition-all",children:[e.jsx(Y,{size:20})," ",e.jsx("span",{className:"text-sm tracking-wide uppercase font-semibold",children:a("logout")})]})]})})}),e.jsxs("div",{className:"flex-1 bg-white rounded-xl shadow-soft border border-gray-100 p-8 min-h-[600px]",children:[o==="orders"&&e.jsxs("div",{className:"space-y-8 animate-in fade-in duration-500",children:[e.jsx("h2",{className:"text-3xl font-serif font-bold text-coffee-dark border-b border-gray-100 pb-6",children:a("order_history")}),_.length===0?e.jsxs("div",{className:"text-center py-20 space-y-4",children:[e.jsx(w,{size:48,className:"mx-auto text-gray-200"}),e.jsx("p",{className:"text-gray-400",children:a("no_orders_yet")}),e.jsx(y,{to:"/products",children:e.jsx(i,{variant:"outline",className:"border-gold text-gold hover:bg-gold hover:text-white",children:a("browse_shop")})})]}):e.jsx("div",{className:"space-y-6",children:_.map(s=>e.jsxs("div",{className:"p-6 rounded-xl border border-gray-100 hover:border-gold/30 transition-all flex flex-col md:flex-row justify-between items-center gap-6",children:[e.jsxs("div",{className:"flex gap-4 items-center",children:[e.jsx("div",{className:"w-12 h-12 rounded bg-gray-50 flex items-center justify-center",children:e.jsx(w,{size:20,className:"text-gold"})}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-coffee-dark",children:s.id}),e.jsx("p",{className:"text-xs text-gray-400",children:s.date})]})]}),e.jsx(S,{className:s.status==="Delivered"?"bg-green-50 text-green-700 hover:bg-green-100":"bg-gold/10 text-gold hover:bg-gold/20",children:s.status}),e.jsxs("p",{className:"font-serif font-bold text-xl text-coffee-dark tracking-wide",children:["$",s.total.toFixed(2)]})]},s.id))})]}),o==="wishlist"&&e.jsxs("div",{className:"space-y-8 animate-in fade-in duration-500",children:[e.jsx("h2",{className:"text-3xl font-serif font-bold text-coffee-dark border-b border-gray-100 pb-6",children:a("wishlist")}),k.length===0?e.jsxs("div",{className:"text-center py-20 space-y-4",children:[e.jsx(z,{size:48,className:"mx-auto text-gray-200"}),e.jsx("p",{className:"text-gray-400",children:a("wishlist_empty")}),e.jsx(y,{to:"/products",children:e.jsx(i,{className:"bg-coffee-dark text-gold hover:bg-coffee",children:a("start_shopping")})})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:k.map(s=>e.jsxs("div",{className:"group flex gap-4 p-4 rounded-xl border border-gray-100 hover:border-gold/20 transition-all relative",children:[e.jsx("button",{onClick:()=>U(s),className:"absolute top-2 right-2 p-1.5 text-red-300 hover:text-red-500 transition-colors",children:e.jsx(J,{size:16})}),e.jsx("div",{className:"w-24 h-24 flex-shrink-0 overflow-hidden rounded-lg bg-[#F9F7F5]",children:e.jsx("img",{src:s.imageUrl,className:"w-full h-full object-cover group-hover:scale-110 transition-transform duration-500"})}),e.jsxs("div",{className:"flex-1 flex flex-col justify-between py-1",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-serif font-bold text-coffee-dark group-hover:text-gold transition-colors text-sm line-clamp-1",children:s[`name_${L.language}`]||s.name}),e.jsxs("p",{className:"text-lg font-medium text-gold",children:["$",s.price]})]}),e.jsxs(i,{size:"sm",onClick:()=>R(s),className:"w-full h-8 text-[10px] uppercase tracking-widest bg-coffee-dark text-white hover:bg-gold hover:text-coffee-dark transition-all",children:[e.jsx(Z,{size:12,className:"mr-2"})," ",a("add_to_cart")]})]})]},s.id))})]}),o==="invoices"&&e.jsxs("div",{className:"space-y-8 animate-in fade-in duration-500",children:[e.jsx("h2",{className:"text-3xl font-serif font-bold text-coffee-dark border-b border-gray-100 pb-6",children:a("my_invoices")}),e.jsx("div",{className:"space-y-4",children:C.length===0?e.jsx("p",{className:"text-gray-500",children:a("no_invoices")}):C.map(s=>e.jsxs("div",{className:"p-6 rounded-xl border border-gray-100 flex justify-between items-center hover:border-gold/30 transition-all",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-coffee-dark",children:s.invoice_number}),e.jsx("p",{className:"text-sm text-gray-400",children:new Date(s.issued_at).toLocaleDateString()})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-serif font-bold text-xl text-coffee-dark mb-2",children:["$",Number(s.amount).toFixed(2)]}),e.jsx(i,{size:"sm",variant:"outline",className:"border-gold text-gold hover:bg-gold hover:text-white",onClick:()=>T(s),children:a("download_pdf")})]})]},s.id))})]}),o==="addresses"&&e.jsxs("div",{className:"space-y-8 animate-in fade-in duration-500",children:[e.jsxs("div",{className:"flex justify-between items-center border-b border-gray-100 pb-6",children:[e.jsx("h2",{className:"text-3xl font-serif font-bold text-coffee-dark",children:a("addresses")}),e.jsx(i,{onClick:()=>F(!f),className:"bg-gold text-white",children:a(f?"cancel":"add_new")})]}),f&&e.jsx("div",{className:"bg-[#F9F7F5] p-8 rounded-xl border border-gray-100 mb-8",children:e.jsxs("form",{onSubmit:O,className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-widest text-gray-400 mb-2 block",children:a("label")}),e.jsx(c,{value:r.label,onChange:s=>x({...r,label:s.target.value}),placeholder:"Home / Office"})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-widest text-gray-400 mb-2 block",children:a("phone")}),e.jsx(c,{value:r.phone,onChange:s=>x({...r,phone:s.target.value}),placeholder:"+33..."})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-widest text-gray-400 mb-2 block",children:a("street_address")}),e.jsx(c,{value:r.street_address,onChange:s=>x({...r,street_address:s.target.value}),required:!0})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-widest text-gray-400 mb-2 block",children:a("city")}),e.jsx(c,{value:r.city,onChange:s=>x({...r,city:s.target.value}),required:!0})]}),e.jsxs("div",{className:"col-span-1",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-widest text-gray-400 mb-2 block",children:a("postal_code")}),e.jsx(c,{value:r.postal_code,onChange:s=>x({...r,postal_code:s.target.value})})]}),e.jsx("div",{className:"col-span-2",children:e.jsx(i,{type:"submit",className:"w-full bg-coffee-dark text-gold h-12 uppercase tracking-widest text-xs",children:a("save_address")})})]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:I.map(s=>e.jsxs("div",{className:"bg-white p-6 rounded-xl border-l-4 border-gold shadow-sm relative hover:shadow-md transition-shadow",children:[s.is_default&&e.jsx(S,{className:"absolute top-4 right-4 bg-gold/10 text-gold",children:a("default")}),e.jsx("h3",{className:"font-bold text-coffee-dark mb-3 uppercase tracking-wide text-sm",children:s.label||a("address")}),e.jsxs("p",{className:"text-gray-500 leading-relaxed text-sm",children:[s.street_address,e.jsx("br",{}),s.postal_code," ",s.city,e.jsx("br",{}),s.country,e.jsx("br",{}),s.phone&&e.jsx("span",{className:"block mt-2 font-medium text-coffee-dark",children:s.phone})]})]},s.id))})]}),o==="profile"&&e.jsxs("div",{className:"space-y-8 animate-in fade-in duration-500",children:[e.jsx("h2",{className:"text-3xl font-serif font-bold text-coffee-dark border-b border-gray-100 pb-6",children:a("account_details")}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-widest text-gray-400",children:a("full_name")}),e.jsx(c,{defaultValue:l.full_name,className:"h-12"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-bold uppercase tracking-widest text-gray-400",children:a("email_address")}),e.jsx(c,{defaultValue:l.email,disabled:!0,className:"h-12 bg-gray-50 text-gray-400"})]})]}),e.jsx("div",{className:"pt-6",children:e.jsx(i,{className:"bg-coffee-dark text-gold hover:bg-coffee px-12 h-12 uppercase tracking-widest text-xs",children:a("update_profile")})})]})]})]})})]})};export{ne as default};
